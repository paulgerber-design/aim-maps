<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIM Viewer</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <!-- Header -->
  <header id="titleBar">
    <span id="titleText">AIM</span>
    <div id="headerActions">
      <button id="resetBtn" class="iconButton" aria-label="Home" title="Home">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 3l10 9h-3v9h-5v-6h-2v6H6v-9H3l9-9z" fill="currentColor"/>
        </svg>
      </button>
      <button id="saveBtn" class="iconButton" aria-label="Save" title="Save CSV">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M17 17H7v-2h10v2zm0-4H7V11h10v2zm0-4H7V7h10v2zm3-5H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM4 20V6h16v14H4z" fill="currentColor"/>
        </svg>
      </button>
      <button id="uploadBtn" class="iconButton" aria-label="Upload CSV" title="Upload CSV">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 5l5 5h-3v6h-4v-6H7l5-5zm-7 14h14v2H5v-2z" fill="currentColor"/>
        </svg>
      </button>
      <button id="viewTableBtn" class="iconButton" aria-label="View data" title="View data">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M3 3h7v7H3V3zm0 11h7v7H3v-7zm11-11h7v7h-7V3zm0 11h7v7h-7v-7z" fill="currentColor"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- Breadcrumb Navigation -->
  <nav id="breadcrumb" aria-label="Breadcrumb"></nav>

  <!-- View Tabs -->
  <div id="tabBar">
    <button id="aimTab" class="tabButton active" aria-label="Show AIM view">AIM</button>
    <button id="projectsTab" class="tabButton" aria-label="Show projects view">Projects</button>
  </div>

  <!-- AIM View -->
  <div id="aimView">
    <div id="container">
      <div id="chartWrapper">
        <svg id="aimChart" role="img" aria-label="Aspirational Identity Map"></svg>
      </div>
      <div id="sidebar">
        <div id="legend" aria-label="Pillar legend"></div>
        
        <!-- Heatmap Controls -->
        <div id="heatmapToggleContainer">
          <div style="display:flex; align-items:center; gap:4px;">
            <label for="heatmapSelect" style="font-weight:600; margin:0;">Heatmap</label>
            <span id="heatmapInfo" class="info-icon" title="">i</span>
          </div>
          <select id="heatmapSelect" aria-label="Select heatmap type">
            <option value="off">Off</option>
            <option value="confidence">Alignment</option>
            <option value="ac">Adaptive challenge</option>
            <option value="ce">Celebration</option>
            <option value="cx">Collective experience</option>
          </select>
          <div id="heatmapLegend"></div>
        </div>

        <!-- Lenses -->
        <div id="lensesBlock" aria-label="Lenses section">
          <div style="display:flex; align-items:center; gap:4px; font-weight:600; margin-bottom:4px;">
            <span id="lensesTitle">Lenses</span>
            <span id="lensesInfo" class="info-icon" title="A Lens is an enjoyable entry point you feel drawn to.">i</span>
          </div>
          <div id="lensesList">No lenses</div>
        </div>

        <input type="file" id="csvFileInput" accept=".csv" style="display:none" aria-label="CSV file input">
      </div>
    </div>
  </div>

  <!-- Projects View -->
  <div id="projectsView">
    <h2>Projects</h2>
    <div id="projectsList"></div>
    <button id="showMoreProjectsBtn">Show more</button>
    <button id="showLessProjectsBtn">Show less</button>
  </div>

  <!-- Tooltip -->
  <div id="tooltip" role="tooltip" aria-hidden="true"></div>

  <!-- Table Overlay -->
  <div id="tableOverlay" role="dialog" aria-modal="true" aria-label="AIM table view">
    <div class="tableContainer">
      <button id="closeTableBtn">Close</button>
      
      <div style="margin:6px 0; display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
        <label for="editTitleInput" style="font-size:0.85rem;">Name:</label>
        <input type="text" id="editTitleInput" placeholder="Enter map name">
        <button id="downloadCsvBtn" class="iconButton" aria-label="Save CSV" title="Save CSV">
          <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 2v14m0 0l-5-5m5 5l5-5M5 20h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
          </svg>
        </button>
        <button id="editDataBtn" class="iconButton" aria-label="Edit data" title="Edit data">
          <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" fill="currentColor"/>
          </svg>
        </button>
      </div>

      <div style="margin-bottom:6px; display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
        <select id="tableFilterSelect">
          <option value="all">All entries</option>
        </select>
        <input type="search" id="tableSearch" placeholder="Search..." aria-label="Search">
      </div>

      <div id="editNote">Changes only persist for this session. Download CSV to save.</div>
      
      <div id="dataTabBar">
        <button id="dataTabAimBtn" class="tabButton active">Beliefs</button>
        <button id="dataTabProjectsBtn" class="tabButton">Projects</button>
      </div>

      <table id="nodeTable">
        <thead>
          <tr><th>Depth</th><th>Pillar</th><th>Sub</th><th>Micro</th><th>Title</th><th>Belief</th><th>Confidence</th><th>Updated</th></tr>
        </thead>
        <tbody></tbody>
      </table>

      <table id="projectsTable" style="display:none;">
        <thead>
          <tr><th>Name</th><th>Type</th><th>Measure</th><th>Start</th><th>Target</th><th>Days/wk</th><th>Duration</th><th>Benefit</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="js/config.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/data-parser.js"></script>
  <script src="js/state-manager.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
